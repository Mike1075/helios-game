

### **项目代号：“赫利俄斯”（Helios）**

### **产品需求文档 (PRD) v1.0 - MVP“棱镜之心”**

**版本：** 1.0
**日期：** 2025年8月7日
**文档状态：** **基线（Baseline）** - 本文档是四周MVP开发的“唯一真相来源”。
**项目负责人：** Mike

---

### **1. 愿景与哲学：意识的棱镜**

“赫利俄斯”不是一个传统的游戏，它是一个**“意识探索与演化的沙盒”**，一个我们称之为**“意识的棱镜”**的宇宙。

* **核心理念：** 玩家投入的不是时间或技能，而是他们纯粹的**意识之光**。这束光透过他们内心独特的**“信念系统”（棱镜）**，折射出独一无二的个人体验。所有玩家折射出的光影，共同交织，形成了“赫利俄斯”这个不断演化、充满主观解读的共享现实。
* **MVP目标 (“棱镜之心”)：** 在四周内，创造一个包含**2个核心NPC**和**1个简单场景**的微型世界，让玩家能完整地体验到从**“基于信念的行动”**到**“通过‘回响之室’看清自我”**的核心循环，从而验证我们整个设计的核心哲学。

---

### **2. 核心体验循环 (The Core Experience Loop)**

玩家在“赫利俄斯”中的旅程，是一个不断内省与演化的循环：

1. **诞生 (Birth):** 玩家通过一系列充满哲思的互动，塑造出其角色的**初始“信念系统”**。这个过程本身就是一次深度的自我探索。
2. **互动 (Interaction):** 玩家带着这套信念进入世界。他的每一个行为都源于这套信念，而世界（NPC）对他的每一次反馈，都将经过这套信念的“过滤”和“解读”，形成高度主观的体验。
3. **内省 (Introspection):** 当遇到**“认知失调”**（即现实反馈与核心信念产生冲突）时，玩家可以进入**“回响之室”**。在这里，他看到的不是客观的因果，而是**自己信念的回声**——一个完全主观的、由他自己信念系统生成的“合理解释”。
4. **演化 (Evolution):** 通过一次次的内省，玩家逐渐看清自己的信念是如何塑造他的世界。当面临重大的“认知失调”时，他将拥有一次**重塑信念**的机会。每一次对信念的调整，都是一次真正的“角色成长”。

---

### **3. MVP功能需求**

#### **3.1. 信念系统 (The Belief System)**

* **用户故事：** 作为一个游戏设计师，我希望能够用一种结构化的方式定义NPC和玩家的内在驱动力，并让它能被AI系统理解和执行。
* **功能需求：**
  1. **Belief DSL (领域特定语言):** 能够以YAML或JSON格式，定义一个角色的信念网络，包含`世界观信念`、`自我观信念`、`价值观信念`。
  2. **Belief Compiler:** 提供一个Python脚本，能将上述YAML/JSON文件，编译成一个LLM可直接使用的**System Prompt**文本。
  3. **演化机制（MVP简化版）：** 在`agent_logs`中记录下每一次“认知失调”的事件。暂不实现信念的自动演化，但为未来迭代预留接口。

#### **3.2. 高性能代理核心 (Agent Core)**

* **用户故事：** 作为一个玩家，我希望与NPC的对话能得到快速、且符合其性格（信念）的响应。
* **功能需求：**
  1. **API接口：** 提供一个核心的`/api/chat`接口，接收`player_id`和`message`。
  2. **信念加载：** 接口在收到请求后，能根据`player_id`从Supabase中读取对应的信念系统Prompt。
  3. **记忆检索：** 能根据`player_id`作为`session_id`，从Zep中拉取最近的对话历史。
  4. **LLM调用：** **必须**通过Vercel AI Gateway，将信念Prompt、对话历史和用户消息组装后，调用指定的LLM。
  5. **日志记录：** 将每一轮交互的关键信息（输入、输出、决策依据）写入Supabase的`agent_logs`表。

#### **3.3. “回响之室” (The Chamber of Echoes)**

* **用户故事：** 作为一个玩家，当我对自己游戏中的遭遇感到困惑时，我希望能理解“为什么会这样”，并从中获得启示。
* **功能需求：**
  1. **API接口：** 提供一个`/api/echo`接口，接收`player_id`和困惑的`event_id`。
  2. **主观归因生成：** 接口能加载该玩家的信念系统，并结合相关日志，调用LLM生成一段**第一人称的、主观的因果解释**，并找出1-2个最相关的近期事件作为“证据”。
  3. **前端呈现：** 前端需要一个专用界面，清晰地展示这段“回响”（主观归因）和相关的“记忆证据”（事件）。

#### **3.4. 导演引擎 (Director Engine) - MVP简化版**

* **用户故事：** 作为一个设计师，我希望系统能在我设定的规则下，自动为玩家创造进入“回响之室”的契机。
* **功能需求：**
  1. **n8n工作流：** 创建一个n8n工作流，名为“认知失调触发器”。
  2. **触发机制：** 监听`agent_logs`表。
  3. **核心逻辑：** 当检测到可能引发冲突的事件（例如，一个正面行为导致了负面反馈），工作流被触发。
  4. **行动：** 向`events`表中插入一条记录，通知前端该玩家有一次进入“回响之室”的机会。

---

### **4. MVP技术架构与选型 (v3.1)**

* **统一应用平台：** **Vercel**
  * **前端:** Next.js
  * **后端 (Agent Core / 回响之室):** Python (FastAPI) on Vercel Serverless Functions
  * **API网关:** Vercel Edge Functions
* **AI服务网关：** **Vercel AI Gateway** (采用统一计费模式)
* **数据后端：** **Supabase** (PostgreSQL + pgvector)
* **记忆引擎：** **Zep** (自托管或云端)
* **工作流引擎：** **n8n** (自托管或云端)

---

### **5. 团队协作与工作流**

* **团队模式：** **“线下核心熔炉”** (8人) + **“线上远程工坊”** (8人)。
* **代码协作：** **GitHub**作为唯一的代码协作中心，采用**“分支 + Pull Request”**模型。
* **部署与预览：** **Vercel**与GitHub深度集成，所有PR自动生成可供全体成员测试的**预览部署**。
* **项目负责人 (Mike)：** 拥有`main`分支的唯一合并权限。

---

### **6. MVP范围界定 (In Scope / Out of Scope)**

#### **✅ MVP必须包含 (In Scope):**

* 一个纯文字的前端界面。
* 玩家初始“信念系统”的简单生成流程。
* 一个简单的场景（例如：一个酒馆）。
* 两个核心NPC，各自拥有明确的、由Belief DSL定义的信念系统。
* 完整的“对话-记录-冲突检测-触发回响之室-主观归因”核心循环。

#### **❌ MVP绝对不包含 (Out of Scope):**

* **任何图形化内容** (场景图片、角色立绘等)。
* **玩家离线AI代理 (“感知交接协议”)。**
* **宏大的世界观与“神兽原型”系统。**
* 复杂的任务系统、物品系统、战斗系统。
* 多场景、多NPC。

---

### **7. MVP成功标准**

我们的成功不以功能数量或用户数量来衡量，而是以**能否验证核心体验**为标准：

1. **信念一致性：** 玩家是否能清晰地感受到两个NPC的行为和言语，与其背后设定的信念系统是高度一致的？
2. **“Aha!”时刻：** 玩家在体验“回响之室”后，是否能产生“原来是我的想法导致了这一切”的恍然大悟之感？
3. **技术可行性：** 整个技术栈（Vercel, Supabase, n8n, Zep）是否能顺畅地协同工作，支撑起核心循环？

只要这三点得到肯定的答案，我们的“棱镜之心”MVP就是巨大的成功。
