

### **项目代号：“赫利俄斯”（Helios）**

### **产品需求文档 (PRD) v1.2 - MVP“创世之心”**

**版本：** 1.2
**日期：** 2025年8月14日
**文档状态：** **基线（Baseline）** - 本文档是四周MVP开发的唯一技术与设计依据。
**项目负责人：** Mike

---

### **1. 核心哲学：本我之镜 (The Mirror of the Self)**

“赫利俄斯”不是一个游戏，它是一个**“意识探索与演化的沙盒”**。

* **核心理念：** 我们不为角色预设信念，我们只**发现**信念。游戏世界是一面**“本我之镜”**，玩家投入的是其最真实的内在人性。游戏的核心功能，是将玩家（和AI）这套**内在、隐形**的信念系统，通过游戏世界的互动**“映照”**出来，让他第一次有机会亲眼“看见”那个一直在驱动自己的“本我”。
* **MVP目标 (“创世之心”)：** 在四周内，创造一个包含**3-4个人类玩家席位**和**7-8个核心AI NPC**的微型社会生态（例如，一个港口酒馆及其周边），以完整验证**信念的涌现、传播和冲突**这一核心循环。

---

### **2. 核心体验与游戏循环**

#### **2.1 游戏循环**

1. **诞生 (Birth):** 玩家进入游戏时，不选择职业或信念，只有一个简单的**角色身份**和一个**初始动机**。
2. **互动 (Interaction):** 玩家在世界中自由行动。他的每一个决策都将被系统记录。
3. **映照 (Reflection):** 后台的**“信念观察者”**系统，会持续分析玩家的行为，动态地、从无到有地为他生成并更新一套**隐形的“信念系统”**。
4. **内省 (Introspection):** 当玩家的行动结果与他潜意识中的预期产生冲突（即“认知失调”）时，他将有机会进入**“回响之室”**，看到一次由他自己信念系统生成的、完全主观的因果归因。
5. **演化 (Evolution):** 通过一次次的“内省”，玩家逐渐看清自己的信念。当面临重大“认知失天调”时，AI代理在离线期间可能会**重塑信念**，实现真正的角色成长。

#### **2.2 时间与回合机制**

* **事件即时间：** 游戏世界没有全局同步的时钟。时间的流逝由有意义的“事件”（一个决策、一个动作）来定义和推进。
* **动态回合制：**
  * **人类玩家优先：** 当人类玩家在场时，关键事件的推进会等待他的输入。
  * **超时机制：** 为保证世界不被卡住，对玩家的决策设有**超时限制**（例如30秒）。超时不响应，将被视为一种“不作为”的行动，NPC会据此继续反应。
  * **交错事件流：** 场景中的任何角色（玩家或NPC）都可以随时发起行动，该行动会作为一个新的“回合”插入事件流，并广播给所有在场者。

---

### **3. MVP功能需求**

#### **3.1 信念系统 (The Belief System) - “涌现式”**

* **用户故事：** 作为一个玩家，我希望游戏能反映出我真实的行为模式，而不是强迫我扮演别人。
* **功能需求：**
  1. **初始设定 (AI NPC):** 只需为每个NPC设定一个`id`, `name`, `role`, `tags`，和一个**核心动机 (core_motivation)** 字符串。
  2. **初始设定 (玩家):** 玩家只有一个`role`和`core_motivation`。
  3. **信念观察者 (Belief Observer):**
     * **实现方式：** 一个Supabase数据库函数+触发器，异步运行。
     * **触发：** 每当`agent_logs`表新增N条（例如20条）某个角色的记录时触发。
     * **逻辑：** 调用一个强大的LLM（如Claude 3.5 Sonnet），输入该角色的所有相关日志，并要求它根据行为**总结、生成或更新**该角色的Belief YAML文件（包含`worldview`, `selfview`, `values`的信念网络）。
     * **存储：** 将生成的YAML文件内容存放在Supabase的`belief_systems`表中。

#### **3.2 高性能代理核心 (Agent Core)**

* **用户故事：** 作为一个玩家，我希望与NPC的对话能得到快速、且符合其动态性格的响应。
* **功能需求（`/api/chat`）：**
  1. **信念加载：** 从Supabase的`belief_systems`表中读取目标NPC的最新Belief YAML内容。
  2. **Prompt编译：** 将YAML内容实时编译成一个结构化的System Prompt。
  3. **记忆检索：** 从Zep拉取对话历史。
  4. **LLM调用：** 通过Vercel AI Gateway调用LLM。
  5. **日志记录：** 将交互的关键信息写入`agent_logs`表。

#### **3.3 “回响之室” (The Chamber of Echoes)**

* **用户故事：** 作为一个玩家，当我感到困惑时，我希望能理解“为什么会这样”。
* **功能需求（`/api/echo`）：**
  1. **信念加载：** 从`belief_systems`表读取**玩家自己**的最新信念。
  2. **主观归因生成：** 将玩家的困惑、信念系统和相关日志作为Prompt，调用LLM生成一段**第一人称的、主观的**因果解释和1-2条记忆证据。

#### **3.4 导演引擎 (Director Engine) - 数据库内生**

* **用户故事：** 作为一个设计师，我希望世界能根据内部状态自发地产生波澜。
* **功能需求：**
  1. **实现方式：** 完全使用Supabase数据库函数和触发器。
  2. **认知失调触发器：** 监听`agent_logs`表，当检测到信念冲突行为时，自动向`events`表插入`catalyst.dissonance`事件。
  3. **世界张力调节器（可选）：** 创建一个定时任务（Cron Job），每天运行一次数据库函数，计算世界的总体“冲突指数”或“资源稀缺度”，如果低于阈值，则向`events`表插入一个全局“催化剂”事件。

---

### **4. MVP技术架构与数据模型 (v4.1)**

* **统一应用平台：** Vercel
* **数据与逻辑后端：** Supabase (PostgreSQL + Triggers + Edge Functions)
* **记忆引擎：** Zep
* **AI服务网关：** Vercel AI Gateway

#### **核心数据表 (Supabase):**

* **`characters`:** 存储所有角色（玩家/NPC）的基础信息 (`id`, `name`, `role`, `core_motivation`, `is_player`)。
* **`belief_systems`:** 存储每个角色动态生成的Belief YAML内容 (`character_id`, `belief_yaml`, `last_updated`)。
* **`agent_logs`:** 记录每一次有意义的交互 (`id`, `timestamp`, `character_id`, `scene_id`, `action_type`, `input`, `output`, `belief_snapshot`)。
* **`events`:** 记录由导演引擎或核心交互触发的事件 (`id`, `timestamp`, `type`, `payload`)。

---

### **5. 团队协作与工作流 (v1.2)**

* **模式：** “零信任本地开发”，测试重心在Vercel的**预览部署**上。
* **代码协作：** GitHub **“分支 + Pull Request”**模型，`main`分支受保护。
* **密钥管理：** Mike在Vercel云端统一管理所有环境变量。

---

### **6. 验收标准**

1. **信念涌现：** 游戏运行一段时间后，我们能否在`belief_systems`表中，看到为每个玩家和NPC生成的、符合他们行为的、独一无二的信念档案？
2. **主观归因：** 玩家在“回响之室”中看到的解释，是否与其自身的行为模式和推断出的信念高度相关，并能引发“Aha! Moment”？
3. **社会生态：** 增加到7-8个NPC和3-4个玩家后，世界中是否开始自发地涌现出我们未曾预料到的**关系变化、冲突和合作**？


