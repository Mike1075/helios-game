# Vercel AI SDK 5 功能介绍

Vercel AI SDK 5 是一个面向 TypeScript 和 JavaScript 的开源 AI 应用工具包，旨在通过统一的 API 和强大的 Web 框架集成，简化并增强全栈 AI 应用的开发体验。 以下是 AI SDK 5 引入的主要功能和改进：

### 1. 重新设计的聊天（Redesigned Chat）

AI SDK 5 对聊天功能进行了彻底的重构，实现了端到端的类型安全。

* **分离 UI 和模型消息**: `UIMessage` 作为应用状态的唯一真实来源，包含了完整的消息、元数据和工具调用结果，建议用于持久化存储。而 `ModelMessage` 则是为发送给大语言模型而优化的精简格式。这种分离简化了聊天记录的持久化过程。
* **可定制的 UI 消息与数据部分 (Data Parts)**: 开发者可以定义包含自定义元数据和数据结构的 `UIMessage` 类型，并在服务器和客户端之间共享，实现全栈类型安全。此外，“数据部分”功能允许从服务器向客户端流式传输任意类型的结构化数据，例如状态更新或部分工具结果，而无需进行复杂的运行时类型检查。
* **类型安全的工具调用**: 工具调用现在具有类型特定的标识符（如 `tool-TOOLNAME`），并为输入和输出提供了端到端的类型安全。工具的输入参数现在默认以流式传输，并且错误状态被明确处理，使开发者能构建更精细、更可靠的用户界面。 [1. ]
* **消息元数据**: 开发者可以为消息附加类型安全的元数据，例如时间戳、模型 ID 或 Token 数量，这些元数据会在消息生命周期的不同阶段动态更新。

### 2. 增强的框架支持和模块化架构

* **模块化与可扩展性**: 新的 `useChat` hook 采用模块化设计，支持自定义传输层（如使用 WebSockets 替代默认的 fetch）、与外部状态管理库（如 Zustand、Redux）解耦以及为任何框架构建自定义聊天 hook。
* **扩展的框架支持**: AI SDK 5 将重构后的聊天体验带到了所有主流 Web 框架中，实现了 Vue 和 Svelte 与 React 的功能对等，并新增了对 Angular 的支持。
* **SSE 流式传输**: AI SDK 现已采用服务器发送事件 (SSE) 作为标准流式传输协议，使其更稳健且易于调试。

### 3. 代理循环控制（Agentic Loop Control）

为了构建更可靠的 AI 代理，SDK 5 引入了精确控制执行流程和上下文的新功能。

* **`stopWhen`**: 允许开发者定义工具调用循环的停止条件，例如达到最大步骤数或调用了某个特定工具。
* **`prepareStep`**: 允许在代理执行的每一步之前动态调整参数，例如切换模型、修改系统提示、筛选上下文消息或改变可用工具。

### 4. 实验性的语音生成与转录

AI SDK 5 将其统一的 API 抽象扩展到了语音领域，提供了与文本生成类似的、可在不同提供商（如 OpenAI, ElevenLabs, DeepGram）之间轻松切换的接口。

* **`experimental_generateSpeech`**: 用于文本到语音的生成。
* **`experimental_transcribe`**: 用于语音到文本的转录。

### 5. 工具功能改进（Tool Improvements）

* **动态工具 (Dynamic Tools)**: 支持在运行时动态定义和执行工具，适用于无法在开发时预知具体工具的场景（如用户自定义函数或外部工具提供商）。
* **支持提供商执行的工具**: 内置支持由 AI 提供商（如 OpenAI 的网页搜索）直接执行并返回结果的工具，SDK 会自动将结果附加到消息历史中。
* **工具生命周期钩子**: 提供了如 `onInputStart`、`onInputDelta` 等精细的生命周期钩子，允许在工具输入的不同阶段向客户端发送状态更新。

### 6. 其他重要更新

* **全局提供商 (Global Provider)**: 允许开发者仅使用模型 ID 字符串（如 `'openai/gpt-4o'`）来调用模型，无需在每次调用时都实例化提供商。默认使用 Vercel AI Gateway，但也可以自定义为其他提供商。
* **访问原始响应**: 提供了访问原始请求和响应数据的能力，为调试和处理特定于提供商的功能提供了便利。
* **支持 Zod 4**: 支持使用 Zod 3 或 Zod 4 进行输入输出的数据验证。
