# PR 检查清单

## 提交前自检

### ✅ 代码质量
- [ ] TypeScript 编译无错误
- [ ] 遵循项目代码规范
- [ ] 关键路径添加了适当的错误处理
- [ ] 环境变量缺失时能优雅降级，不崩溃

### ✅ 功能完整性
- [ ] 新增的 API 端点都有对应的类型定义
- [ ] 数据库操作使用了正确的 Service Key
- [ ] AI 调用统一通过 Vercel AI Gateway
- [ ] 前端状态管理合理（Loading/Error）

### ✅ 安全性
- [ ] 没有硬编码任何密钥或敏感信息
- [ ] Supabase RLS 正确配置
- [ ] API 端点有适当的输入验证

### ✅ 可观测性
- [ ] 服务端关键操作添加了 console.info 日志
- [ ] 错误处理包含有意义的错误信息
- [ ] 数据库操作失败时有适当的日志记录

## PR 描述模板

```markdown
## What / 做了什么
- [ ] 具体功能描述
- [ ] 主要文件变更说明

## Why / 为什么要做
- [ ] 解决的问题或实现的需求
- [ ] 对项目目标的推进作用

## 测试计划
- [ ] 本地开发环境测试要点
- [ ] Vercel 预览环境验证清单
- [ ] 数据库操作验证步骤

## 环境变量需求
请维护者在 Vercel 项目中配置以下环境变量：
- [ ] `SUPABASE_URL` - Supabase 项目 URL
- [ ] `SUPABASE_SERVICE_KEY` - Supabase Service Role Key  
- [ ] `OPENAI_API_KEY` - OpenAI API 密钥（或其他 AI Gateway 配置）

## Vercel 预览链接
- [ ] 预览链接: [待 PR 创建后自动生成]
- [ ] 功能验证: [在预览环境中测试核心功能]

🤖 Generated with [Claude Code](https://claude.ai/code)
```

## Fork PR 特殊说明

如果这是一个 Fork PR，请在描述中添加：

> **⚠️ 维护者注意**  
> 这是一个 Fork PR，需要您手动在 Vercel 项目设置中批准环境变量注入。请确保以下变量在预览环境中可用：
> - SUPABASE_URL  
> - SUPABASE_SERVICE_KEY
> - OPENAI_API_KEY

## 合并前最终检查

### ✅ 部署验证
- [ ] Vercel 部署成功，无构建错误
- [ ] 预览环境核心功能正常
- [ ] 数据库连接和操作正常
- [ ] AI 调用响应正常

### ✅ 性能检查  
- [ ] 页面加载速度合理
- [ ] API 响应时间在可接受范围
- [ ] 数据库查询效率合理

### ✅ 用户体验
- [ ] 界面操作流畅
- [ ] 错误状态有合理提示
- [ ] Loading 状态用户感知清晰

## 常见问题解决

### 本地环境变量缺失
✅ **正确**: 代码优雅降级，显示提示信息  
❌ **错误**: 应用崩溃或白屏

### API 调用失败
✅ **正确**: 捕获错误，显示用户友好的提示  
❌ **错误**: 未处理的异常导致页面崩溃

### 数据库连接问题
✅ **正确**: 检查环境变量，graceful fallback  
❌ **错误**: 直接抛出数据库连接错误

---

*遵循这个清单有助于保证代码质量和项目的零信任开发原则。*