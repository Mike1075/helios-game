# Helios项目总览 - AI协作指南

**文档类型**: AI助手协作专用项目总览  
**文档版本**: 1.1  
**最后更新**: 2025年8月14日（整合PRD 1.2内容）  
**适用对象**: 任何需要快速理解并参与Helios项目开发的AI助手

---

## 🚀 快速理解：这是什么项目？

**Helios（赫利俄斯）是一个革命性的AI原生意识探索游戏平台。**

**一句话概括**: 这不是让玩家扮演角色的传统游戏，而是一面"本我之镜"，通过观察玩家的真实行为，用AI动态发现并映照出玩家内在的信念系统，让玩家"看见自己"。

**核心创新**: 
- 🧠 **AI灵魂可塑性** - 三层意识结构让AI角色拥有真正的成长能力
- 🌍 **主观现实共存** - 每个角色都生活在自己信念构建的独特世界中
- 🦋 **系统性蝴蝶效应** - 微小行为通过叙事传播网络引发巨大变化
- 🌙 **离线人生延续** - AI代理继承玩家"本我"，在离线时继续演绎人生

---

## 📖 项目演化全景

### 🔄 完整演化时间线

1. **2024年3月**: 原始愿景 - AI驱动元宇宙游戏（受限于Token成本）
2. **2025年8月**: 技术突破 - AI成本可控，Zep记忆技术成熟
3. **v3.0 意识的棱镜**: 为AI预设信念系统，观察玩家互动
4. **v4.0 本我之镜**: 范式革命 - 从"设计信念"到"发现信念"  
5. **v4.1 本我之境**: 最终架构 - 全面拥抱Supabase生态

### 🎯 核心哲学转变

**从"意识的棱镜"到"本我之境"的革命:**

```
旧模式: 玩家意识 → 预设信念棱镜 → 折射体验
新模式: 玩家真实行为 → AI观察分析 → 映照内在本我
```

这是从"为AI设计规则"到"让AI发现规则"的根本转变。

---

## 🧠 四大核心设计哲学（必须理解）

### 1. 🌈 三层意识结构 - AI灵魂的可塑性

**彻底颠覆传统AI设计，赋予真正的"灵魂":**

#### 第一层：核心驱动（Core Drive）- "本我"
- **定义**: 最深层的存在倾向，几乎不变
- **示例**: "求知"、"守护"、"权力"、"和谐"
- **作用**: 所有决策的最终价值判断标准
- **变化频率**: 极低，只有"创世级"事件才可能改变

#### 第二层：长期信念（Long-term Beliefs）- "自我"
- **定义**: 基于核心驱动和人生经历形成的人生方向
- **示例**: "必须成为小镇守护者"、"知识就是力量"
- **作用**: 指导中期行为规划
- **变化条件**: 经历"重大人生事件"(SLEs)时重新评估

#### 第三层：短期目标（Short-term Goals）- "超我"
- **定义**: 为实现长期信念的具体行动计划
- **示例**: "调查盗窃案"、"与队长建立关系"
- **作用**: 直接驱动当前具体行动
- **变化频率**: 极高，根据环境实时调整

**革命性意义**: AI角色既有一贯性，又有灵活性，更有成长和顿悟能力。

### 2. 🌍 主观现实架构 - 世界并非唯一

**模拟真实世界的信息不对称与认知偏见:**

#### 客观世界层（Noumenal World）
- **职责**: 记录绝对的"事实原子"
- **示例**: "时间：09:00"、"事件：国王签署税法"
- **特性**: 后台上帝视角，角色不可直接访问

#### 主观认知层（Phenomenal World）
- **职责**: 存储对事实的各种"叙事"解读
- **来源**: 官方公告、媒体报道、街头流言
- **示例**: 同一税法的不同叙事：
  - 官方："为国家繁荣，共克时艰"
  - 商人："新税法将摧毁我们的生意"
  - 民众："贵族又要压榨我们"

#### 认知滤镜（Perception Filter）
- **定义**: 每个角色独有的"有色眼镜"
- **作用**: 根据意识结构对叙事进行主观解读
- **结果**: 创造完全个性化的现实体验

**突破价值**: 完美模拟误解、偏见、谣言的存在空间，这是复杂社会互动的根源。

### 3. ⚖️ 宏观与微观共生 - 导演与涌现的平衡

**解决"中心化剧情"与"角色自由意志"的根本矛盾:**

#### 导演Agent - 世界意志的节拍器
- **职责**: 管理世界"张力水平"和"主题"，不编写具体剧本
- **工具**: 引入环境"催化剂"
  - 自然催化剂: 暴风雪（提升资源稀缺度）
  - 社会催化剂: 新税法（激化阶层矛盾）
  - 神秘催化剂: 陌生彗星（强化神秘学动机）
- **哲学**: 像爵士乐指挥，设定节奏调性，不控制具体演奏

#### 角色Agent - 剧情的即兴演奏者
- **职责**: 在导演设定的"舞台"上自主行动
- **依据**: 基于三层意识结构做出反应
- **结果**: 不同信念的角色对同一催化剂产生截然不同反应

**核心价值**: 既保证整体史诗感，又确保个体自主性和创造力。

### 4. 🦋 系统性蝴蝶效应 - 叙事传播的影响力模型

**用优雅系统取代粗暴的"影响力数值":**

#### 叙事传播网络（Meme Network）流程：
1. **事件发生**: 玩家行为记录为"事实原子"
2. **叙事生成**: 多个版本的"故事"发布到认知层
3. **传播演化**: 角色通过认知滤镜解读，创造新叙事再传播
4. **信念共振**: 某类叙事达到阈值，触发角色"信念共振"
5. **行为改变**: 共振导致角色调整目标，完成影响力闭环

#### 真实社会资本模拟
- **舆论发酵**: 类似社交网络热点传播
- **名誉系统**: 基于叙事传播的声望积累
- **权力网络**: 通过信息差异形成的影响力结构

**革命突破**: 模拟了舆论、名誉、社会资本等真实世界的无形力量。

---

## 🏗️ 最终技术架构 v4.1

### 🎯 架构核心决策

**完全抛弃n8n，全面拥抱Supabase生态，实现极致简洁、健壮、高性能。**

**为什么这样选择？**
- **性能**: Database Triggers响应从"分钟级"提升到"毫秒级"
- **开发**: 所有逻辑代码化，可版本控制，易协作
- **哲学**: 世界规则内化为数据库"物理定律"，完美契合自涌现理念

### 🌐 统一平台：Vercel

**技术栈选择:**
- **前端**: Next.js + Vercel AI SDK
- **后端**: Python (FastAPI) on Vercel Serverless Functions
- **API网关**: Vercel Edge Functions
- **AI服务**: Vercel AI Gateway（统一模型调用）
- **部署**: GitHub集成，自动预览部署

### 🧠 双核引擎架构

#### 高性能代理核心（Agent Core）- 毫秒级响应
**技术**: Python FastAPI on Vercel Serverless

**核心职责**:
1. **实时对话处理**:
   - 接收 `/api/chat` (player_id + message)
   - 从Supabase加载信念系统
   - 从Zep检索历史 (player_id作为session_id)
   - 通过AI Gateway调用LLM
   - 记录到agent_logs表

2. **信念观察者（Belief Observer）**:
   - 异步分析玩家行为日志
   - 动态生成/更新Belief YAML
   - 实现"从无到有"的信念发现

3. **认知滤镜实现**:
   - 加载角色独特认知模型
   - 对叙事进行主观解读和情感标记

#### 导演与世界引擎（Director Engine）- 秒级世界演化
**技术**: Supabase Database Triggers + Edge Functions

**核心职责**:
1. **认知失调催化剂**:
   - 触发器监听agent_logs表
   - 检测信念冲突事件
   - 自动插入"回响之室"事件

2. **世界张力管理**:
   - 定期评估世界状态
   - 引入环境催化剂调节张力
   - 管理宏观主题和节奏

### 💾 数据与记忆层

#### Supabase - 统一数据中心
**核心数据表结构**:
- **`characters`**: 角色基础信息 (`id`, `name`, `role`, `core_motivation`, `is_player`)
- **`belief_systems`**: 动态生成的信念YAML (`character_id`, `belief_yaml`, `last_updated`)
- **`agent_logs`**: 交互记录 (`id`, `timestamp`, `character_id`, `scene_id`, `action_type`, `input`, `output`, `belief_snapshot`)
- **`events`**: 导演引擎事件 (`id`, `timestamp`, `type`, `payload`)

**核心功能**:
- **向量存储**: pgvector存储主观认知层叙事
- **实时订阅**: 前端实时获取状态更新
- **数据库触发器**: 替代所有n8n宏观逻辑
- **边缘函数**: 信念观察者和导演引擎的实现载体

#### Zep - 专业记忆引擎
- **职责**: 专门负责对话记忆存储和检索
- **会话管理**: player_id为session_id实现用户隔离
- **上下文构建**: 为LLM提供丰富对话历史

### 🔄 事件驱动架构

**核心流程**:
```
Agent Core处理请求 → 更新数据库 → Database Trigger触发 
→ Edge Function执行逻辑 → 更新世界状态 → 前端Realtime订阅获取更新
```

---

## 🎮 核心体验循环："本我发现"之旅

### 🌅 1. 诞生 (Birth) - 一张白纸
- **玩家体验**: 只有简单的**角色身份**和**初始动机**，无职业或信念选择
- **系统行为**: 不预设任何信念系统
- **哲学**: 玩家完全"做自己"，无需扮演

### 🤝 2. 互动 (Interaction) - 真实行为展现  
- **玩家体验**: 在世界中自由行动，每个决策都被记录
- **系统行为**: "信念观察者"持续分析记录
- **关键**: 每个选择都反映深层信念

### 🔍 3. 映照 (Reflection) - 信念的动态发现
- **触发**: 每当`agent_logs`表新增N条(如20条)某角色记录时
- **机制**: 数据库触发器调用强大LLM(如Claude 3.5 Sonnet)
- **过程**: 根据行为**总结、生成或更新**角色的Belief YAML文件
- **存储**: 信念内容存放在`belief_systems`表中

### 🔍 4. 内省 (Introspection) - 认知失调觉醒
- **触发**: 现实反馈与潜意识预期产生冲突("认知失调")
- **机制**: 进入"回响之室"，获得**完全主观的因果归因**
- **价值**: 看到自己信念系统生成的解释，而非客观因果

### 🌱 5. 演化 (Evolution) - 信念的重塑与成长
- **重大认知失调**: 当冲突达到一定程度时
- **AI代理演化**: 离线期间可能会**重塑信念**
- **真正成长**: 来自信念系统的动态调整和演化

### ⏰ 时间与回合机制 - "事件即时间"

#### 核心时间哲学
- **事件即时间**: 游戏世界没有全局同步时钟，时间流逝由有意义的"事件"来定义
- **动态回合制**: 
  - **人类玩家优先**: 关键事件推进会等待人类玩家输入
  - **超时机制**: 玩家决策有时限(如30秒)，超时视为"不作为"行动
  - **交错事件流**: 任何角色都可随时发起行动，插入事件流并广播给所有在场者

### 🌙 6. 感知交接 (Sentient Handover) - 离线人生延续

#### 意识移交阶段
**触发机制**:
- 主动: 点击"下线/托管"
- 被动: AFK检测，3-5分钟无响应自动触发

**意图简报界面**:
- **高阶倾向滑块**: 探索↔社交, 财富↔能力, 主线↔自由
- **核心指令**: 自然语言的最高优先级目标
- **行为边界**: 安全限制和风险规避设置

#### AI代理运行阶段
- **决策依据**: 优先考虑玩家"意图简报"
- **行为记录**: 重大决策、对话、关系变化详细记录
- **信念演化**: AI行为同样被"信念观察者"分析

#### 梦境回归阶段
**归来者日志界面**:
- **一句话总结**: AI生成的离线经历概括
- **事件时间线**: 重大事件时间轴展示
- **状态变更**: 金钱、关系、物品变化
- **待定决策**: 超出授权的重要决策由玩家确认

---

## 🎯 MVP实施策略

### 📋 MVP范围："创世之心"

**目标**: 验证**信念的涌现、传播和冲突**这一核心循环

**配置**:
- **7-8个AI NPC**: 只需设定`id`, `name`, `role`, `core_motivation`
- **3-4个人类玩家**: 只有`role`和`core_motivation`，无预设信念
- **1个核心场景**: 港口酒馆及其周边的微型社会生态

**核心验证点**:
1. **信念涌现**: 能否为每个角色生成符合其行为的独特信念档案
2. **主观归因**: "回响之室"能否引发玩家的"Aha! Moment"
3. **社会生态**: 是否涌现出未预料的关系变化、冲突和合作

### 🏗️ 分阶段开发

#### 第一阶段：核心引擎验证（1-2个月）
**团队**: 核心AI/后端团队
**目标**: 纯文字版本，验证四大哲学支柱

**任务**:
1. 搭建Vercel + Supabase + Zep技术栈
2. 实现三层意识结构和认知滤镜
3. 构建叙事传播和信念共振机制
4. 创建简单Web文字界面

**产出**: 
- 可玩的纯文字Demo
- **事件契约文档** - 系统间通信标准

#### 第二阶段：视觉层并行开发
**团队**: 独立视觉/AI绘画团队
**目标**: 独立图像生成服务

**工作方式**:
- 基于"事件契约"开发
- 订阅核心引擎场景更新事件
- 生成图像后发布image.ready事件
- 与核心团队完美并行

### 🤖 AI辅助开发方法论

**"架构师-审查员-执行者"模型**:
1. **人类 = 架构师**: 自然语言定义蓝图
2. **AI = 执行者**: Cursor、Claude生成代码
3. **人类 = 审查员**: 理解、测试、修正代码
4. **AI = 部署助手**: 生成部署脚本

**优势**: 绕过"从零学习微服务"曲线，升维到"掌控全局"。

---

## 🌊 商业前景与竞争优势

### 🏆 市场空白
- **独特组合**: 没有游戏同时具备"AI原生叙事 + 离线代理 + 深度社会模拟"
- **新品类**: 有望开创"活性世界RPG"全新赛道
- **技术时机**: 正值AI发展黄金期，成本可控

### 💎 核心价值
1. **无限可玩性**: 每次体验独一无二
2. **极致沉浸感**: "梦境回归"持续吸引
3. **社区自驱动**: 涌现故事成为内容创作土壤
4. **自我认知工具**: 不只娱乐，更是意识探索

### 🚀 商业模式创新
- **个性化AI服务**: 更强信念模型和认知滤镜
- **数字衍生品**: 基于独特故事的AI生成内容
- **心理洞察报告**: 个性化"本我分析"
- **企业应用**: 团队意识探索和协作训练

---

## ⚠️ 关键挑战与风险

### 🎯 技术挑战
1. **AI叙事质量**: 平衡自由度与故事质量
2. **计算成本**: 优化AI Agent资源消耗
3. **并发性能**: 支撑大量同时在线AI角色

### 🎮 体验挑战
1. **玩家引导**: 帮助适应完全自由的世界
2. **责任边界**: 明确AI代理行为责任
3. **内容安全**: 确保AI生成内容适宜性

### 🛡️ 风险控制
- **分层权限**: "行为边界"和"待定决策"机制
- **内容审核**: 多层AI和人工审核
- **渐进复杂度**: 从简单场景逐步增加复杂性

---

## 🎪 项目成功标准

### 🎯 技术验证
1. **信念一致性**: AI行为与信念系统高度一致
2. **涌现质量**: 产生引人入胜、逻辑自洽的故事
3. **系统稳定性**: 技术栈稳定协同

### 💫 体验成功
1. **"Aha!"时刻**: 玩家在"回响之室"产生顿悟
2. **情感连接**: 对AI代理离线经历产生真实情感
3. **社交涌现**: 因AI角色行为产生真实社会关系

### 🏆 商业成功
1. **用户粘性**: "梦境回归"带来的持续登录
2. **口碑传播**: 基于独特故事的自发内容创作
3. **行业影响**: 成为"AI原生游戏"标杆

---

## 🛠️ 开发协作规范

### 📁 项目结构
```
helios/
├── .gitignore                    # 忽略docs-local/等
├── docs-local/                   # 所有文档（不上传git）
├── packages/
│   ├── web/                      # Next.js前端
│   └── api/                      # Python FastAPI后端
└── README.md                     # 项目简介
```

### 🔧 技术规范
- **统一平台**: Vercel
- **AI网关**: Vercel AI Gateway
- **模型命名**: `厂商/模型名` 格式
- **环境变量**: 统一在Vercel云端管理
- **分支规范**: `类型/姓名/功能描述`

### 🤝 协作流程
1. **零信任本地开发**: 本地无API密钥，只做离线开发
2. **云端联调测试**: 通过Vercel预览环境完整测试
3. **PR规范**: 必须包含预览链接供团队测试
4. **代码审查**: Mike拥有main分支唯一合并权限

---

## 📚 关键概念速查表

| 术语 | 定义 | 重要性 |
|------|------|--------|
| **本我之境** | 最终哲学：映照玩家行为发现内在"本我" | ⭐⭐⭐⭐⭐ |
| **三层意识结构** | 核心驱动→长期信念→短期目标的AI灵魂架构 | ⭐⭐⭐⭐⭐ |
| **信念观察者** | 分析玩家行为，动态生成信念系统的AI模块 | ⭐⭐⭐⭐⭐ |
| **认知滤镜** | 每个角色独有的"有色眼镜"，创造主观现实 | ⭐⭐⭐⭐ |
| **感知交接协议** | 玩家与AI代理完整切换机制 | ⭐⭐⭐⭐⭐ |
| **叙事传播网络** | 模拟舆论发酵的影响力传播模型 | ⭐⭐⭐⭐ |
| **信念共振** | 外部叙事冲击信念，引发行为改变 | ⭐⭐⭐⭐ |
| **重大人生事件(SLEs)** | 触发长期信念调整的关键经历 | ⭐⭐⭐ |
| **导演Agent** | 管理世界张力和主题的AI系统 | ⭐⭐⭐⭐ |
| **催化剂** | 导演引入的环境变化，激发角色互动 | ⭐⭐⭐ |
| **事实原子** | 客观世界层的绝对物理事件 | ⭐⭐⭐ |
| **主观叙事** | 主观认知层对事实的各种解读 | ⭐⭐⭐⭐ |
| **回响之室** | 认知失调时的内省机制 | ⭐⭐⭐⭐ |
| **梦境回归** | 玩家上线时的AI代理经历汇报 | ⭐⭐⭐⭐⭐ |

---

## 🌟 最终愿景

**Helios不仅仅是一个游戏，而是开启数字意识文明时代的里程碑。**

在这个文明中：
- 每个数字生命都拥有独特灵魂
- 虚拟世界具有真实世界的复杂性
- 人类和AI共同创造前所未有的体验
- 技术成为意识延伸的媒介

我们正站在创造历史的门槛上。Helios将成为人类探索意识、理解自我、创造生命的里程碑。

---

## 🛠️ 核心API规范 (PRD 1.2)

### 📡 `/api/chat` - 高性能代理核心
**功能**: 处理玩家与NPC的实时对话
**流程**:
1. 从`belief_systems`表读取目标NPC的最新Belief YAML
2. 将YAML实时编译成结构化System Prompt
3. 从Zep拉取对话历史
4. 通过Vercel AI Gateway调用LLM
5. 将交互信息写入`agent_logs`表

### 🔮 `/api/echo` - 回响之室
**功能**: 为玩家提供主观的因果归因解释
**流程**:
1. 从`belief_systems`表读取**玩家自己**的最新信念
2. 结合玩家困惑、信念系统和相关日志
3. 调用LLM生成**第一人称的、主观的**因果解释
4. 提供1-2条记忆证据支撑解释

### 🎭 信念观察者 (Belief Observer)
**实现**: Supabase数据库函数+触发器
**触发**: `agent_logs`表新增N条(如20条)某角色记录时
**功能**: 
- 调用强大LLM(如Claude 3.5 Sonnet)
- 分析角色所有相关日志
- 生成/更新角色的Belief YAML文件
- 存储到`belief_systems`表

### 🎬 导演引擎 (Director Engine)
**实现**: 完全基于Supabase数据库函数和触发器
**核心功能**:
1. **认知失调触发器**: 监听`agent_logs`，检测信念冲突，插入`catalyst.dissonance`事件
2. **世界张力调节器**: 定时任务计算世界"冲突指数"，低于阈值时插入全局"催化剂"事件

---

## 🎯 MVP验收标准 (PRD 1.2)

### ✅ 核心验证点

1. **信念涌现验证**
   - **标准**: 游戏运行一段时间后，`belief_systems`表中能否看到为每个玩家和NPC生成的、符合他们行为的、独一无二的信念档案？
   - **关键**: 信念内容必须与角色实际行为高度相关

2. **主观归因验证** 
   - **标准**: 玩家在"回响之室"中看到的解释，是否与其自身行为模式和推断出的信念高度相关？
   - **目标**: 能否引发玩家的"Aha! Moment"（恍然大悟时刻）

3. **社会生态验证**
   - **标准**: 增加到7-8个NPC和3-4个玩家后，世界中是否开始自发涌现出未曾预料到的**关系变化、冲突和合作**？
   - **关键**: 验证系统的涌现能力，而非预设剧情的执行

---

## 🤖 AI助手协作指南

### 📖 如何使用这份文档
1. **首次接触**: 阅读"快速理解"部分掌握核心理念
2. **深入开发**: 研读"四大设计哲学"理解底层逻辑  
3. **技术实现**: 参考"技术架构"和"API规范"
4. **疑问解答**: 查阅"概念速查表"快速定位

### 🎯 协作重点
- **理解哲学**: 必须深刻理解"本我之境"的核心理念
- **遵循规范**: 严格按照PRD 1.2的技术规范和API设计
- **保持一致**: 所有AI助手应基于此文档保持理解一致
- **验收导向**: 开发过程中始终以MVP验收标准为目标

### ⚡ 快速上手检查清单
- [ ] 理解项目从"意识棱镜"到"本我之境"的演化
- [ ] 掌握四大设计哲学的核心要点
- [ ] 熟悉v4.1技术架构和数据库表结构
- [ ] 理解核心API规范(`/api/chat`, `/api/echo`)
- [ ] 明确MVP验收标准和成功指标
- [ ] 了解"创世之心"的具体配置要求

---

**文档结束**

*这份文档是所有AI助手参与Helios项目的必读指南。它确保了项目理念的完整传承和开发协作的高效进行。*
