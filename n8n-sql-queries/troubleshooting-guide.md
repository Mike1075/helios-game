# ğŸ”§ n8n SQL æŸ¥è¯¢æ•…éšœæ’é™¤æŒ‡å—

## ğŸ¯ é—®é¢˜: "There is no connection back to the node" é”™è¯¯

### åŸå› åˆ†æ
- èŠ‚ç‚¹å¼•ç”¨åç§°ä¸åŒ¹é…
- èŠ‚ç‚¹ä¹‹é—´æ²¡æœ‰æ­£ç¡®è¿æ¥
- å˜é‡å¼•ç”¨æ ¼å¼é”™è¯¯

### è§£å†³æ­¥éª¤

#### æ­¥éª¤1: ç¡®è®¤èŠ‚ç‚¹è¿æ¥
1. ç¡®ä¿"è·å–ä¿¡å¿µç³»ç»Ÿ"èŠ‚ç‚¹è¿æ¥åœ¨"è·å–å½“å‰è§’è‰²"èŠ‚ç‚¹ä¹‹å
2. æ£€æŸ¥æ•°æ®æµå‘æ˜¯å¦æ­£ç¡®

#### æ­¥éª¤2: ç¡®è®¤èŠ‚ç‚¹åç§°
åœ¨ n8n ä¸­æŸ¥çœ‹å‰ç½®èŠ‚ç‚¹çš„ç¡®åˆ‡åç§°ï¼Œæ³¨æ„ï¼š
- å¤§å°å†™æ˜¯å¦åŒ¹é…
- æ˜¯å¦æœ‰é¢å¤–çš„ç©ºæ ¼
- æ˜¯å¦æœ‰ç‰¹æ®Šå­—ç¬¦

#### æ­¥éª¤3: æµ‹è¯•ä¸åŒçš„å¼•ç”¨æ–¹å¼

**æ–¹å¼1: æ ‡å‡†å¼•ç”¨**
```sql
WHERE character_id = '{{ $("è·å–å½“å‰è§’è‰²").item.json.character_id }}';
```

**æ–¹å¼2: æ–¹æ‹¬å·å¼•ç”¨ (å¤„ç†ç‰¹æ®Šå­—ç¬¦)**
```sql
WHERE character_id = '{{ $["è·å–å½“å‰è§’è‰²"].item.json.character_id }}';
```

**æ–¹å¼3: èŠ‚ç‚¹ç´¢å¼•å¼•ç”¨**
```sql
WHERE character_id = '{{ $node[0].json.character_id }}';
```

**æ–¹å¼4: ä» webhook ç›´æ¥è·å–**
```sql
WHERE character_id = '{{ $json.body.character_id }}';
```

#### æ­¥éª¤4: è°ƒè¯•æŸ¥è¯¢
ä½¿ç”¨è¿™ä¸ªæŸ¥è¯¢æŸ¥çœ‹å‰ç½®èŠ‚ç‚¹çš„å®é™…è¾“å‡ºï¼š
```sql
SELECT '{{ $("è·å–å½“å‰è§’è‰²").item.json }}' as debug_output;
```

## ğŸš€ æ¨èçš„æµ‹è¯•æµç¨‹

### 1. å…ˆç”¨ç¡¬ç¼–ç æµ‹è¯•
```sql
SELECT * FROM belief_systems WHERE character_id = 'shy_student';
```

### 2. æµ‹è¯•å˜é‡å¼•ç”¨
```sql
SELECT '{{ $json.body.user_id }}' as test_user_id;
```

### 3. æµ‹è¯•å‰ç½®èŠ‚ç‚¹å¼•ç”¨
```sql
SELECT '{{ $("è·å–å½“å‰è§’è‰²").item.json.character_id }}' as test_character_id;
```

### 4. å®Œæ•´åŠ¨æ€æŸ¥è¯¢
```sql
SELECT * FROM belief_systems 
WHERE character_id = '{{ $("è·å–å½“å‰è§’è‰²").item.json.character_id }}';
```

## ğŸ“‹ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1: èŠ‚ç‚¹åç§°åŒ…å«ä¸­æ–‡
**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨æ–¹æ‹¬å·æˆ–ç´¢å¼•å¼•ç”¨
```sql
-- ä½¿ç”¨æ–¹æ‹¬å·
WHERE character_id = '{{ $["è·å–å½“å‰è§’è‰²"].item.json.character_id }}';

-- ä½¿ç”¨ç´¢å¼•
WHERE character_id = '{{ $node[0].json.character_id }}';
```

### é—®é¢˜2: æ•°æ®ç»“æ„ä¸ç¡®å®š
**è§£å†³æ–¹æ¡ˆ**: å…ˆæŸ¥çœ‹æ•°æ®ç»“æ„
```sql
SELECT 
    '{{ $json }}' as webhook_data,
    '{{ $("è·å–å½“å‰è§’è‰²").item.json }}' as node_data;
```

### é—®é¢˜3: ç©ºå€¼å¤„ç†
**è§£å†³æ–¹æ¡ˆ**: æ·»åŠ é»˜è®¤å€¼
```sql
WHERE character_id = '{{ $("è·å–å½“å‰è§’è‰²").item.json.character_id || "shy_student" }}';
```

## ğŸ¯ æœ€ç»ˆå»ºè®®

1. **å…ˆç¡®ä¿ç¡¬ç¼–ç æŸ¥è¯¢å·¥ä½œ** âœ…
2. **é€æ­¥æ›¿æ¢ä¸ºåŠ¨æ€å¼•ç”¨**
3. **ä½¿ç”¨è°ƒè¯•æŸ¥è¯¢ç¡®è®¤æ•°æ®æ ¼å¼**
4. **é€‰æ‹©æœ€é€‚åˆçš„å¼•ç”¨æ–¹å¼**

å¦‚æœæ‰€æœ‰åŠ¨æ€æ–¹å¼éƒ½ä¸å·¥ä½œï¼Œå¯ä»¥è€ƒè™‘ï¼š
- ä¿®æ”¹å‰ç«¯ï¼Œç›´æ¥åœ¨ webhook ä¸­ä¼ é€’ character_id
- ä½¿ç”¨ n8n çš„ Set èŠ‚ç‚¹æ¥å¤„ç†æ•°æ®è½¬æ¢
