-- ========================================
-- 获取角色的信念系统数据 (动态版本)
-- ========================================
-- 
-- 基于您的硬编码查询可以工作，这里提供几种动态引用方式
-- 请根据您的实际节点名称选择合适的版本
-- 
-- ========================================

-- ========================================
-- 版本1: 标准节点引用 (如果前置节点名为 "获取当前角色")
-- ========================================
SELECT
    id,
    content,
    embedding,
    character_id,
    created_at
FROM belief_systems
WHERE character_id = '{{ $("获取当前角色").item.json.character_id }}';

-- ========================================
-- 版本2: 如果前置节点名为其他名称，请替换节点名
-- ========================================
-- 例如，如果节点名为 "获取角色":
-- SELECT
--     id,
--     content,
--     embedding,
--     character_id,
--     created_at
-- FROM belief_systems
-- WHERE character_id = '{{ $("获取角色").item.json.character_id }}';

-- ========================================
-- 版本3: 使用节点索引引用 (如果节点名称有特殊字符)
-- ========================================
-- SELECT
--     id,
--     content,
--     embedding,
--     character_id,
--     created_at
-- FROM belief_systems
-- WHERE character_id = '{{ $node[0].json.character_id }}';

-- ========================================
-- 版本4: 从 webhook 直接获取 (如果有 character_id)
-- ========================================
-- SELECT
--     id,
--     content,
--     embedding,
--     character_id,
--     created_at
-- FROM belief_systems
-- WHERE character_id = '{{ $json.body.character_id }}';

-- ========================================
-- 版本5: 使用 JSON 路径 (更安全的引用方式)
-- ========================================
-- SELECT
--     id,
--     content,
--     embedding,
--     character_id,
--     created_at
-- FROM belief_systems
-- WHERE character_id = '{{ $("获取当前角色").item.json["character_id"] }}';

-- ========================================
-- 调试版本: 先测试前置节点的输出
-- ========================================
-- 如果不确定前置节点的输出格式，可以先用这个查询测试:
-- SELECT '{{ $("获取当前角色").item.json }}' as debug_output;

-- ========================================
-- 使用建议
-- ========================================
-- 
-- 1. 首先确认您的前置节点的确切名称
-- 2. 在 n8n 中测试前置节点，确保它返回 character_id
-- 3. 选择上面合适的版本
-- 4. 如果仍有问题，使用调试版本查看实际输出格式
-- 
-- 常见问题解决:
-- - 节点名称包含特殊字符 → 使用版本3 (索引引用)
-- - 节点名称不匹配 → 检查实际节点名称，使用版本2
-- - 数据结构不同 → 使用调试版本查看实际结构
-- 
-- ========================================
