# Helios é¡¹ç›®éƒ¨ç½²åéªŒè¯æ¸…å•

åŸºäºä½ æˆåŠŸéƒ¨ç½²çš„ Supabase Edge Functionsï¼Œè¿™é‡Œæ˜¯å®Œæ•´çš„ç³»ç»ŸéªŒè¯æ¸…å•ã€‚

## âœ… å·²å®Œæˆçš„éƒ¨ç½²

### 1. Supabase CLI å®‰è£…å’Œé…ç½®
- [x] Windows ç¯å¢ƒä¸‹ Supabase CLI å®‰è£…æˆåŠŸ
- [x] é¡¹ç›®é“¾æ¥é…ç½® (Project Ref: vfendokbefodfxwutgyc)
- [x] è®¤è¯å’Œæˆæƒé…ç½®å®Œæˆ

### 2. è¾¹ç¼˜å‡½æ•°éƒ¨ç½²
- [x] `belief-analyzer` è¾¹ç¼˜å‡½æ•°éƒ¨ç½²æˆåŠŸ
- [x] `ai-autonomous-behavior` è¾¹ç¼˜å‡½æ•°éƒ¨ç½²æˆåŠŸ
- [x] å‡½æ•°åœ¨ Supabase ä»ªè¡¨æ¿ä¸­å¯è§

### 3. ç¯å¢ƒå˜é‡é…ç½®
- [x] `VERCEL_AI_GATEWAY_URL` å·²é…ç½®
- [x] `VERCEL_AI_GATEWAY_API_KEY` å·²é…ç½®  
- [x] `SUPABASE_SERVICE_ROLE_KEY` ç³»ç»Ÿè‡ªåŠ¨æ³¨å…¥

### 4. å‰ç«¯é›†æˆæ›´æ–°
- [x] supabase.ts ä¸­æ·»åŠ äº†è¾¹ç¼˜å‡½æ•°è°ƒç”¨å°è£…
- [x] WorldEngine æ›´æ–°ä¸ºä½¿ç”¨è¾¹ç¼˜å‡½æ•°
- [x] å®æ—¶è®¢é˜…ç³»ç»Ÿå·²é…ç½®

## ğŸ”„ æ¥ä¸‹æ¥éœ€è¦éªŒè¯çš„åŠŸèƒ½

### 1. è¾¹ç¼˜å‡½æ•°è°ƒç”¨æµ‹è¯•
åœ¨ Vercel é¢„è§ˆç¯å¢ƒä¸­è¿è¡Œä»¥ä¸‹æµ‹è¯•ï¼š

```bash
# åœ¨ packages/web ç›®å½•ä¸‹
npm run test:edge
```

**é¢„æœŸç»“æœ:**
- belief-analyzer å‡½æ•°è¿”å›æˆåŠŸå“åº”
- ai-autonomous-behavior å‡½æ•°è¿”å›æˆåŠŸå“åº”
- æ•°æ®åº“è¡¨è®¿é—®æ­£å¸¸
- å®æ—¶è®¢é˜…è¿æ¥æˆåŠŸ

### 2. æ ¸å¿ƒæ¸¸æˆå¾ªç¯éªŒè¯

#### 2.1 ä¿¡å¿µç³»ç»Ÿåˆ†ææµç¨‹
- [ ] ç©å®¶å¯¹è¯è§¦å‘ agent_logs è®°å½•
- [ ] belief-analyzer å‡½æ•°è‡ªåŠ¨åˆ†æç©å®¶è¡Œä¸º
- [ ] ä¿¡å¿µç³»ç»Ÿæ›´æ–°åˆ° belief_systems è¡¨
- [ ] è®¤çŸ¥å¤±è°ƒæ£€æµ‹è§¦å‘ player_events è®°å½•
- [ ] å‰ç«¯æ”¶åˆ°å®æ—¶äº‹ä»¶ï¼Œæ˜¾ç¤ºå›å“ä¹‹å®¤é‚€è¯·

#### 2.2 AI è‡ªä¸»è¡Œä¸ºæµç¨‹  
- [ ] AI è§’è‰²çŠ¶æ€åœ¨ character_states è¡¨ä¸­æ­£å¸¸æ›´æ–°
- [ ] ai-autonomous-behavior å‡½æ•°å®šæœŸæ‰§è¡Œ
- [ ] AI ç”Ÿæˆçš„è‡ªä¸»è¡Œä¸ºè®°å½•åˆ° scene_events è¡¨
- [ ] å‰ç«¯å®æ—¶æ¥æ”¶ AI è¡Œä¸ºäº‹ä»¶å¹¶æ˜¾ç¤º

#### 2.3 å®æ—¶è®¢é˜…ç³»ç»Ÿ
- [ ] åœºæ™¯äº‹ä»¶è®¢é˜… (`scene_events:moonlight_tavern`)
- [ ] ç©å®¶çŠ¶æ€è®¢é˜… (`player_status:player_id`)
- [ ] è§’è‰²çŠ¶æ€è®¢é˜… (`character_states:all`)

### 3. æ•°æ®åº“è§¦å‘å™¨éªŒè¯

åˆ›å»ºæ•°æ®åº“è§¦å‘å™¨æ¥è‡ªåŠ¨è°ƒç”¨è¾¹ç¼˜å‡½æ•°ï¼š

```sql
-- å½“æ’å…¥æ–°çš„ agent_logs æ—¶ï¼Œè§¦å‘ä¿¡å¿µåˆ†æ
CREATE OR REPLACE FUNCTION trigger_belief_analysis()
RETURNS TRIGGER AS $$
BEGIN
  -- è°ƒç”¨ belief-analyzer è¾¹ç¼˜å‡½æ•°
  PERFORM supabase_function_call('belief-analyzer', 
    json_build_object(
      'player_id', NEW.character_id,
      'recent_logs_count', 5
    )
  );
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER belief_analysis_trigger
  AFTER INSERT ON agent_logs
  FOR EACH ROW
  WHEN (NEW.character_id = 'player')
  EXECUTE FUNCTION trigger_belief_analysis();
```

### 4. æ€§èƒ½åŸºå‡†æµ‹è¯•

#### 4.1 å“åº”æ—¶é—´éªŒè¯
- [ ] belief-analyzer: < 3ç§’
- [ ] ai-autonomous-behavior: < 2ç§’
- [ ] å®æ—¶äº‹ä»¶ä¼ æ’­: < 500ms

#### 4.2 æˆæœ¬æ•ˆç›ŠéªŒè¯
- [ ] ä½¿ç”¨ Qwen 2.5-14B æ¨¡å‹é™ä½æˆæœ¬
- [ ] è¾¹ç¼˜å‡½æ•°æ‰§è¡Œæ—¶é—´ä¼˜åŒ–
- [ ] æ•°æ®åº“æŸ¥è¯¢æ•ˆç‡æ£€æŸ¥

## ğŸš€ éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

### 1. GitHub Actions å·¥ä½œæµ
ç¡®ä¿ä»¥ä¸‹ç¯å¢ƒå˜é‡åœ¨ Vercel ä¸­æ­£ç¡®é…ç½®ï¼š
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `SUPABASE_SERVICE_KEY`
- `VERCEL_AI_GATEWAY_URL`
- `VERCEL_AI_GATEWAY_API_KEY`
- `ZEP_API_KEY`

### 2. ç›‘æ§å’Œæ—¥å¿—
- [ ] Supabase å‡½æ•°è°ƒç”¨æ—¥å¿—ç›‘æ§
- [ ] Vercel éƒ¨ç½²çŠ¶æ€æ£€æŸ¥
- [ ] å®æ—¶è®¢é˜…è¿æ¥çŠ¶æ€ç›‘æ§

## ğŸ¯ MVP æˆåŠŸæ ‡å‡†

1. **ä¿¡å¿µä¸€è‡´æ€§**: NPC è¡Œä¸ºä¸å®šä¹‰çš„ä¿¡å¿µç³»ç»Ÿä¿æŒä¸€è‡´
2. **"å•Šå“ˆï¼"æ—¶åˆ»**: ç©å®¶åœ¨å›å“ä¹‹å®¤ä¸­ä½“éªŒåˆ°"æˆ‘çš„æƒ³æ³•åˆ›é€ äº†è¿™ä¸ªç»“æœ"çš„é¡¿æ‚Ÿ
3. **æŠ€æœ¯å¯è¡Œæ€§**: å®Œæ•´æŠ€æœ¯æ ˆ(Vercel + Supabase Edge Functions + Zep)å¹³ç¨³è¿è¡Œï¼Œå…·æœ‰å®æ—¶æ€§èƒ½

## ğŸ“ é—®é¢˜æ’æŸ¥

å¦‚æœé‡åˆ°é—®é¢˜ï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºæ£€æŸ¥ï¼š

1. **è¾¹ç¼˜å‡½æ•°æ—¥å¿—**: åœ¨ Supabase ä»ªè¡¨æ¿æŸ¥çœ‹å‡½æ•°æ‰§è¡Œæ—¥å¿—
2. **Vercel AI Gateway**: æ£€æŸ¥ API è°ƒç”¨é…é¢å’Œå“åº”çŠ¶æ€
3. **æ•°æ®åº“è¿æ¥**: éªŒè¯ Supabase æ•°æ®åº“è¿æ¥å’Œæƒé™
4. **å®æ—¶è®¢é˜…**: æ£€æŸ¥ WebSocket è¿æ¥çŠ¶æ€

## ğŸ‰ éƒ¨ç½²æˆåŠŸæŒ‡æ ‡

å½“ä»¥ä¸‹æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³æ—¶ï¼Œå¯ä»¥è®¤ä¸ºéƒ¨ç½²å®Œå…¨æˆåŠŸï¼š

- [ ] ç©å®¶å¯ä»¥ä¸ NPC è¿›è¡Œå¯¹è¯
- [ ] AI è§’è‰²ä¼šè‡ªä¸»æ‰§è¡Œè¡Œä¸º
- [ ] ä¿¡å¿µç³»ç»Ÿä¼šæ ¹æ®ç©å®¶è¡Œä¸ºåŠ¨æ€æ›´æ–°  
- [ ] è®¤çŸ¥å¤±è°ƒæ£€æµ‹è§¦å‘å›å“ä¹‹å®¤é‚€è¯·
- [ ] æ‰€æœ‰å®æ—¶äº‹ä»¶éƒ½èƒ½æ­£ç¡®ä¼ æ’­åˆ°å‰ç«¯
- [ ] ç³»ç»Ÿåœ¨ Vercel ç”Ÿäº§ç¯å¢ƒä¸­ç¨³å®šè¿è¡Œ